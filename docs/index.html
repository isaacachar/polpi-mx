<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polpi MX ‚Äî Inteligencia Inmobiliaria Powered by AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0F1629; color: #F1F5F9; overflow-x: hidden; }
        .nav { position: sticky; top: 0; z-index: 1000; background: #0F1629; border-bottom: 1px solid rgba(74, 158, 255, 0.15); padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; backdrop-filter: blur(20px); }
        .logo { font-size: 1.5rem; font-weight: 700; color: #4A9EFF; display: flex; align-items: center; gap: 0.5rem; }
        .search-container { flex: 1; max-width: 600px; margin: 0 2rem; position: relative; }
        .search-input { width: 100%; padding: 0.875rem 1.25rem; background: rgba(26, 35, 50, 0.8); border: 1px solid rgba(74, 158, 255, 0.2); border-radius: 12px; color: #F1F5F9; font-size: 0.95rem; backdrop-filter: blur(10px); transition: all 0.2s ease; }
        .search-input:focus { outline: none; border-color: #4A9EFF; box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1); }
        .search-input::placeholder { color: #94A3B8; }
        .nav-links { display: flex; gap: 2rem; align-items: center; }
        .nav-link { color: #94A3B8; text-decoration: none; font-size: 0.9rem; font-weight: 500; transition: color 0.2s ease; }
        .nav-link:hover { color: #4A9EFF; }
        .market-bar { background: #1A2332; padding: 1rem 2rem; display: flex; align-items: center; justify-content: center; gap: 2rem; border-bottom: 1px solid rgba(74, 158, 255, 0.1); flex-wrap: wrap; }
        .market-stat { display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #94A3B8; }
        .market-stat strong { color: #00D4FF; font-weight: 600; }
        .stat-divider { width: 4px; height: 4px; border-radius: 50%; background: #4A9EFF; }
        .filters { background: #0F1629; padding: 1.25rem 2rem; display: flex; gap: 0.75rem; overflow-x: auto; border-bottom: 1px solid rgba(74, 158, 255, 0.1); }
        .filter-pill { padding: 0.625rem 1.25rem; background: rgba(26, 35, 50, 0.6); border: 1px solid rgba(74, 158, 255, 0.2); border-radius: 20px; color: #F1F5F9; font-size: 0.875rem; font-weight: 500; cursor: pointer; white-space: nowrap; transition: all 0.2s ease; backdrop-filter: blur(8px); }
        .filter-pill:hover { border-color: #4A9EFF; background: rgba(74, 158, 255, 0.1); }
        .filter-pill.active { background: #4A9EFF; border-color: #4A9EFF; color: white; }
        select.filter-pill { appearance: none; padding-right: 2rem; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23F1F5F9' d='M6 9L1 4h10z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.75rem center; }
        .main-content { display: flex; height: calc(100vh - 220px); }
        .map-section { flex: 1; position: relative; }
        #map { width: 100%; height: 100%; }
        .maplibregl-popup-content { background: #1A2332; color: #F1F5F9; border-radius: 8px; padding: 1rem; border: 1px solid rgba(74, 158, 255, 0.2); }
        .maplibregl-popup-tip { border-top-color: #1A2332 !important; }
        .cards-section { flex: 1; overflow-y: auto; padding: 2rem; background: #0F1629; }
        .results-header { margin-bottom: 1.5rem; color: #94A3B8; font-size: 0.875rem; }
        .results-count { color: #4A9EFF; font-weight: 600; }
        .property-card { background: #1E2A3A; border-radius: 12px; overflow: hidden; margin-bottom: 1.5rem; border: 1px solid rgba(74, 158, 255, 0.15); transition: all 0.2s ease; cursor: pointer; opacity: 0; animation: fadeIn 0.4s ease forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        .property-card:hover { transform: translateY(-2px); border-color: #4A9EFF; box-shadow: 0 8px 24px rgba(74, 158, 255, 0.15); }
        .property-card.highlight { border-color: #00D4FF; box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.2); }
        .card-image { position: relative; height: 200px; background: linear-gradient(135deg, #1E2A3A 0%, #2D3B4F 100%); display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .card-image img { width: 100%; height: 100%; object-fit: cover; }
        .card-image-placeholder { font-size: 3rem; opacity: 0.3; }
        .ai-badge { position: absolute; top: 0.75rem; left: 0.75rem; padding: 0.375rem 0.875rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; backdrop-filter: blur(10px); border: 1px solid; }
        .ai-badge.great { background: rgba(52, 211, 153, 0.2); border-color: #34D399; color: #34D399; }
        .ai-badge.good { background: rgba(52, 211, 153, 0.15); border-color: #34D399; color: #34D399; }
        .ai-badge.fair { background: rgba(74, 158, 255, 0.2); border-color: #4A9EFF; color: #4A9EFF; }
        .ai-badge.above { background: rgba(251, 191, 36, 0.2); border-color: #FBBF24; color: #FBBF24; }
        .ai-badge.premium { background: rgba(248, 113, 113, 0.2); border-color: #F87171; color: #F87171; }
        .card-content { padding: 1.25rem; }
        .price { font-size: 1.75rem; font-weight: 700; color: #F1F5F9; margin-bottom: 0.25rem; }
        .price-m2 { font-size: 0.875rem; color: #94A3B8; margin-bottom: 1rem; }
        .details { display: flex; gap: 0.75rem; margin-bottom: 1rem; font-size: 0.875rem; color: #94A3B8; }
        .detail-item { display: flex; align-items: center; gap: 0.25rem; }
        .location { font-size: 0.875rem; color: #4A9EFF; margin-bottom: 0.5rem; }
        .comparison { font-size: 0.8rem; color: #94A3B8; margin-bottom: 0.75rem; }
        .ai-insight { font-size: 0.85rem; color: #94A3B8; font-style: italic; padding-top: 0.75rem; border-top: 1px solid rgba(74, 158, 255, 0.1); }
        .footer { background: #1A2332; padding: 2rem; text-align: center; border-top: 1px solid rgba(74, 158, 255, 0.15); }
        .footer-content { color: #94A3B8; font-size: 0.875rem; margin-bottom: 0.75rem; }
        .footer-links { display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap; }
        .footer-link { color: #4A9EFF; text-decoration: none; font-size: 0.875rem; }
        .footer-link:hover { color: #00D4FF; }
        @media (max-width: 768px) {
            .nav { flex-direction: column; gap: 1rem; }
            .search-container { margin: 0; max-width: 100%; }
            .nav-links { gap: 1rem; }
            .main-content { flex-direction: column; height: auto; }
            .map-section { height: 400px; display: none; }
            .map-section.show { display: block; }
            .cards-section { padding: 1rem; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="logo">üêô Polpi MX</div>
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Busca con inteligencia... 'Departamentos en Roma Norte bajo $5M'">
        </div>
        <div class="nav-links">
            <a href="#" class="nav-link">Mercado</a>
            <a href="#" class="nav-link">Colonias</a>
            <a href="#" class="nav-link">Nosotros</a>
        </div>
    </nav>
    <div class="market-bar">
        <div class="market-stat"><strong id="totalListings">83</strong> propiedades en CDMX</div>
        <div class="stat-divider"></div>
        <div class="market-stat">Precio promedio: <strong id="avgPriceM2">$65,000/m¬≤</strong></div>
        <div class="stat-divider"></div>
        <div class="market-stat">‚ñ≤ Trending</div>
        <div class="stat-divider"></div>
        <div class="market-stat">Mejor oportunidad: <strong id="bestDeal">Cuauht√©moc</strong></div>
    </div>
    <div class="filters">
        <button class="filter-pill active">En Venta</button>
        <select class="filter-pill" id="priceFilter">
            <option value="all">Precio ‚ñæ</option>
            <option value="0-3000000">Menos de $3M</option>
            <option value="3000000-5000000">$3M - $5M</option>
            <option value="5000000-10000000">$5M - $10M</option>
            <option value="10000000-20000000">$10M - $20M</option>
            <option value="20000000-999999999">M√°s de $20M</option>
        </select>
        <select class="filter-pill" id="bedroomsFilter">
            <option value="all">Rec√°maras ‚ñæ</option>
            <option value="1">1+</option>
            <option value="2">2+</option>
            <option value="3">3+</option>
            <option value="4">4+</option>
        </select>
        <select class="filter-pill" id="sortFilter">
            <option value="default">Ordenar ‚ñæ</option>
            <option value="price-asc">Precio ‚Üë</option>
            <option value="price-desc">Precio ‚Üì</option>
            <option value="opportunity">Mejor oportunidad</option>
            <option value="size-desc">M√°s grandes</option>
        </select>
    </div>
    <div class="main-content">
        <div class="map-section">
            <div id="map"></div>
        </div>
        <div class="cards-section" id="cardsContainer">
            <div class="results-header">
                Mostrando <span class="results-count" id="resultsCount">83</span> propiedades
            </div>
            <div id="propertyCards"></div>
        </div>
    </div>
    <footer class="footer">
        <div class="footer-content">¬© 2026 Polpi MX ¬∑ Inteligencia Inmobiliaria ¬∑ Ciudad de M√©xico</div>
        <div class="footer-links">
            <a href="#" class="footer-link">T√©rminos</a>
            <a href="#" class="footer-link">Privacidad</a>
            <a href="#" class="footer-link">Contacto</a>
            <a href="#" class="footer-link">API</a>
        </div>
    </footer>
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <script>
        let allListings = [];
        let filteredListings = [];
        let coloniaAverages = {};
        let map, markers = [];
        let searchTimeout;
        
        // Initialize
        fetch('js/data-listings.json')
            .then(r => r.json())
            .then(data => {
                allListings = data.filter(l => l.lat && l.lng && l.price_mxn && l.size_m2);
                calculateColoniaAverages();
                filteredListings = [...allListings];
                initMap();
                renderCards();
                updateStats();
            });
        
        function calculateColoniaAverages() {
            const byColonia = {};
            allListings.forEach(l => {
                const col = l.colonia || 'Desconocido';
                if (!byColonia[col]) byColonia[col] = [];
                byColonia[col].push(l.price_per_m2);
            });
            Object.keys(byColonia).forEach(col => {
                const prices = byColonia[col];
                coloniaAverages[col] = prices.reduce((a,b) => a+b, 0) / prices.length;
            });
        }
        
        function generateInsight(listing) {
            const colAvg = coloniaAverages[listing.colonia] || 65000;
            const priceM2 = listing.price_per_m2;
            const diff = ((priceM2 - colAvg) / colAvg) * 100;
            
            if (diff < -15) return {
                badge: "Gran Oportunidad",
                badgeClass: "great",
                text: "Precio significativamente bajo el promedio de la zona"
            };
            if (diff < -5) return {
                badge: "Buena Oportunidad",
                badgeClass: "good",
                text: `Ideal para inversi√≥n ‚Äî precio competitivo en ${listing.colonia.split(',')[0]}`
            };
            if (diff < 5) return {
                badge: "Precio Justo",
                badgeClass: "fair",
                text: `Alineado con el mercado de ${listing.colonia.split(',')[0]}`
            };
            if (diff < 15) return {
                badge: "Sobre Mercado",
                badgeClass: "above",
                text: "Ligeramente sobre el promedio ‚Äî eval√∫a ubicaci√≥n exacta"
            };
            return {
                badge: "Premium",
                badgeClass: "premium",
                text: "Precio premium ‚Äî verifica amenidades y acabados"
            };
        }
        
        function initMap() {
            map = new maplibregl.Map({
                container: 'map',
                style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
                center: [-99.1332, 19.4326],
                zoom: 11.5
            });
            updateMarkers();
        }
        
        function updateMarkers() {
            markers.forEach(m => m.remove());
            markers = [];
            
            filteredListings.forEach((listing, idx) => {
                const insight = generateInsight(listing);
                const color = insight.badgeClass === 'great' || insight.badgeClass === 'good' ? '#34D399' :
                             insight.badgeClass === 'fair' ? '#4A9EFF' :
                             insight.badgeClass === 'above' ? '#FBBF24' : '#F87171';
                
                const el = document.createElement('div');
                el.style.cssText = `background:${color};color:#0F1629;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:700;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.3);`;
                el.textContent = `$${(listing.price_mxn/1000000).toFixed(1)}M`;
                
                const marker = new maplibregl.Marker({element: el})
                    .setLngLat([listing.lng, listing.lat])
                    .setPopup(new maplibregl.Popup().setHTML(`
                        <div style="color:#F1F5F9">
                            <div style="font-weight:700;margin-bottom:8px">$${listing.price_mxn.toLocaleString()} MXN</div>
                            <div style="font-size:13px;color:#94A3B8;margin-bottom:4px">${listing.bedrooms}rec ¬∑ ${listing.bathrooms}ba√±os ¬∑ ${listing.size_m2}m¬≤</div>
                            <div style="font-size:12px;color:#4A9EFF">${listing.colonia.split(',')[0]}</div>
                            <div style="font-size:11px;color:#94A3B8;margin-top:8px;font-style:italic">${insight.text}</div>
                        </div>
                    `))
                    .addTo(map);
                
                el.addEventListener('click', () => scrollToCard(idx));
                markers.push(marker);
            });
        }
        
        function renderCards() {
            const container = document.getElementById('propertyCards');
            container.innerHTML = '';
            
            filteredListings.forEach((listing, idx) => {
                const insight = generateInsight(listing);
                const colAvg = coloniaAverages[listing.colonia] || 65000;
                const diff = ((listing.price_per_m2 - colAvg) / colAvg) * 100;
                
                const card = document.createElement('div');
                card.className = 'property-card';
                card.id = `card-${idx}`;
                card.style.animationDelay = `${Math.min(idx * 0.05, 1)}s`;
                
                card.innerHTML = `
                    <div class="card-image">
                        ${listing.images && listing.images[0] 
                            ? `<img src="${listing.images[0]}" alt="${listing.title}">`
                            : '<div class="card-image-placeholder">üè¢</div>'}
                        <div class="ai-badge ${insight.badgeClass}">${insight.badge}</div>
                    </div>
                    <div class="card-content">
                        <div class="price">$${(listing.price_mxn/1000000).toFixed(2)}M MXN</div>
                        <div class="price-m2">$${listing.price_per_m2.toLocaleString()}/m¬≤</div>
                        <div class="details">
                            <div class="detail-item">${listing.bedrooms} rec</div>
                            <div class="detail-item">¬∑ ${listing.bathrooms} ba√±os</div>
                            <div class="detail-item">¬∑ ${listing.size_m2} m¬≤</div>
                        </div>
                        <div class="location">üìç ${listing.colonia.split(',')[0]}</div>
                        <div class="comparison">${diff < 0 ? Math.abs(diff).toFixed(0) + '% bajo' : diff > 0 ? diff.toFixed(0) + '% sobre' : 'Al'} el promedio de ${listing.colonia.split(',')[0]}</div>
                        <div class="ai-insight">${insight.text}</div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    map.flyTo({center: [listing.lng, listing.lat], zoom: 14});
                    markers[idx].togglePopup();
                    highlightCard(idx);
                });
                
                container.appendChild(card);
            });
        }
        
        function scrollToCard(idx) {
            const card = document.getElementById(`card-${idx}`);
            if (card) {
                card.scrollIntoView({behavior: 'smooth', block: 'center'});
                highlightCard(idx);
            }
        }
        
        function highlightCard(idx) {
            document.querySelectorAll('.property-card').forEach(c => c.classList.remove('highlight'));
            const card = document.getElementById(`card-${idx}`);
            if (card) {
                card.classList.add('highlight');
                setTimeout(() => card.classList.remove('highlight'), 2000);
            }
        }
        
        function applyFilters() {
            let filtered = [...allListings];
            
            // Price filter
            const priceRange = document.getElementById('priceFilter').value;
            if (priceRange !== 'all') {
                const [min, max] = priceRange.split('-').map(Number);
                filtered = filtered.filter(l => l.price_mxn >= min && l.price_mxn <= max);
            }
            
            // Bedrooms filter
            const minBeds = document.getElementById('bedroomsFilter').value;
            if (minBeds !== 'all') {
                filtered = filtered.filter(l => l.bedrooms >= parseInt(minBeds));
            }
            
            // Search filter
            const search = document.getElementById('searchInput').value.toLowerCase();
            if (search) {
                filtered = filtered.filter(l => 
                    (l.colonia && l.colonia.toLowerCase().includes(search)) ||
                    (l.description && l.description.toLowerCase().includes(search))
                );
            }
            
            // Sort
            const sort = document.getElementById('sortFilter').value;
            if (sort === 'price-asc') filtered.sort((a,b) => a.price_mxn - b.price_mxn);
            else if (sort === 'price-desc') filtered.sort((a,b) => b.price_mxn - a.price_mxn);
            else if (sort === 'opportunity') {
                filtered.sort((a,b) => {
                    const avgA = coloniaAverages[a.colonia] || 65000;
                    const avgB = coloniaAverages[b.colonia] || 65000;
                    const diffA = ((a.price_per_m2 - avgA) / avgA) * 100;
                    const diffB = ((b.price_per_m2 - avgB) / avgB) * 100;
                    return diffA - diffB;
                });
            } else if (sort === 'size-desc') filtered.sort((a,b) => b.size_m2 - a.size_m2);
            
            filteredListings = filtered;
            renderCards();
            updateMarkers();
            updateStats();
        }
        
        function updateStats() {
            document.getElementById('resultsCount').textContent = filteredListings.length;
            document.getElementById('totalListings').textContent = filteredListings.length;
            
            if (filteredListings.length > 0) {
                const avgPrice = filteredListings.reduce((sum, l) => sum + l.price_per_m2, 0) / filteredListings.length;
                document.getElementById('avgPriceM2').textContent = `$${Math.round(avgPrice).toLocaleString()}/m¬≤`;
                
                // Find best deal
                const withAvg = filteredListings.map(l => ({
                    ...l,
                    diff: ((l.price_per_m2 - (coloniaAverages[l.colonia] || 65000)) / (coloniaAverages[l.colonia] || 65000)) * 100
                })).filter(l => l.diff < 0).sort((a,b) => a.diff - b.diff);
                
                if (withAvg.length > 0) {
                    document.getElementById('bestDeal').textContent = withAvg[0].colonia.split(',')[0];
                }
            }
        }
        
        // Event listeners
        document.getElementById('priceFilter').addEventListener('change', applyFilters);
        document.getElementById('bedroomsFilter').addEventListener('change', applyFilters);
        document.getElementById('sortFilter').addEventListener('change', applyFilters);
        document.getElementById('searchInput').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(applyFilters, 300);
        });
    </script>
</body>
</html>